stages:
  - test
  - deploy

test_build:
  stage: test
  rules: 
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
  variables:
    GIT_STRATEGY: clone
  script: ./CI.sh 
  artifacts:
    when: always
    paths:
      - build/results.tex
  tags:
    - sstelmo-shell-aea 

deploy_build:
  stage: deploy
  variables:
    GIT_STRATEGY: clone
  script: ./CD.sh
  tags:
    - sstelmo-shell-aea 
  only:
    - master
    - dev

# It MUST be called pages
pages:
  stage: deploy
  variables:
    GIT_STRATEGY: clone
  script:
    - mkdir public
    - cd docs
    - make html
    - cp -r build/html/* ../public/
    - cd ..
  artifacts:
    paths:
      # It MUST be called public
      - public
  tags:
    - sstelmo-shell-aea 
  only:
    - master
